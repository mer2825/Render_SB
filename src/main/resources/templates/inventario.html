<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}"> <!-- Asegúrate de incluir main.css si es necesario para el diseño general -->
</head>
<body>

<div class="d-flex">
    <div th:replace="~{sidebar :: sidebar(activeUri = ${activeUri})}"></div>

    <main id="main-content" class="main-content w-100">
        <div th:replace="~{header :: header(pageTitle='Gestión de Inventario')}"></div>

        <div class="container-fluid p-4">
            <div class="card shadow-sm rounded-lg">
                <div class="card-body">
                    <h2 class="card-title h5 mb-4 fw-bold">Lista de Productos en Inventario</h2>

                    <div th:if="${productos.isEmpty()}" class="alert alert-info" role="alert">
                        No hay productos registrados en el inventario.
                    </div>

                    <div th:unless="${productos.isEmpty()}">
                        <table id="tablaInventario" class="table table-hover responsive" style="width:100%">
                            <thead class="table-dark">
                                <tr>
                                    <th>Imagen</th>
                                    <th>Producto</th>
                                    <th>Categoría</th>
                                    <th>Stock Actual</th>
                                    <th>Stock Mínimo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="producto : ${productos}">
                                    <td>
                                        <img th:src="@{${producto.foto != null ? producto.foto : '/images/default-product.png'}}" 
                                             alt="Imagen del Producto" 
                                             style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                                    </td>
                                    <td th:text="${producto.nombre}">Nombre del Producto</td>
                                    <td th:text="${producto.categoria.nombre}">Categoría del Producto</td>
                                    <td th:text="${producto.stock}">100</td>
                                    <td th:text="${producto.stockMinimo}">10</td>
                                    <td>
                                        <button type="button" class="btn btn-info btn-sm btn-movimientos" 
                                                th:data-id="${producto.id}" th:data-nombre="${producto.nombre}">
                                            <i class="bi bi-arrow-left-right"></i> Movimientos
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Modal de Movimientos del Producto -->
<div class="modal fade" id="movimientosModal" tabindex="-1" aria-labelledby="movimientosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="movimientosModalLabel">Movimientos de Inventario para: <span id="modalProductoNombre"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table id="tablaMovimientos" class="table table-striped table-hover" style="width:100%">
                        <thead class="table-dark">
                            <tr>
                                <th>N° Venta</th>
                                <th>Fecha Venta</th>
                                <th>Precio Venta</th>
                                <th>Cantidad</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los movimientos se cargarán aquí vía AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="btnExportarPdf">PDF</button>
                <button type="button" class="btn btn-success" id="btnExportarExcel">EXCEL</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="notification-container" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script th:src="@{/js/inventario.js}"></script>
    <script th:src="@{/js/main.js}"></script>
</body>
</html>
